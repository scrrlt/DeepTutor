# Pre-commit hooks configuration for AI-Tutor project
# This configuration ensures code quality and consistency across the team
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Usage:
#   pre-commit run --all-files  # Run on all files
#   git commit  # Hooks run automatically on commit

repos:
  # ============================================
  # General file checks
  # ============================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Remove trailing whitespace
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
        exclude: ^(assets/roster/.*\.svg|.*\.min\.(js|css)|.*\.lock|.*\.log|.*\.pdf|.*\.zip|.*\.tar\.gz)

      # Ensure files end with a newline
      - id: end-of-file-fixer
        exclude: ^(assets/roster/.*\.svg|.*\.min\.(js|css)|.*\.lock|.*\.log|.*\.pdf|.*\.zip|.*\.tar\.gz)

      # Check YAML files for syntax errors
      - id: check-yaml
        args: [--unsafe]  # Allow custom tags in YAML

      # Check JSON files for syntax errors
      - id: check-json
        exclude: ^(.*\.lock|.*\.log)

      # Prevent committing large files
      - id: check-added-large-files
        args: [--maxkb=6144]

      # Detect merge conflict markers
      - id: check-merge-conflict

      # Detect case conflicts in file names
      - id: check-case-conflict

      # Check for files that would conflict in case-insensitive filesystems
      - id: check-toml

  # ============================================
  # Python code formatting and linting
  # ============================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.7
    hooks:
      # Ruff linting - removing --exit-zero to ensure we catch issues before they land
      - id: ruff
        args: [--fix]

      # Ruff import sorting
      - id: ruff-format

  # ============================================
  # Frontend code formatting and linting
  # ============================================
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v9.39.1
    hooks:
      - id: eslint
        files: ^web/.*\.(js|jsx|ts|tsx)$
        exclude: ^web/(node_modules|\.next|out|dist|build)/
        additional_dependencies:
          - eslint@^9.0.0
          - eslint-config-next@^15.0.0
          - "@eslint/eslintrc"
  #       args: [--fix]

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        files: ^web/.*\.(css|scss|json|jsonc|yaml|yml|md|graphql|html|ts|tsx|js|jsx)$
        exclude: ^web/(node_modules|\.next|out|dist|build)/

  # ============================================
  # Security checks
  # ============================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package-lock.json
        pass_filenames: false
